<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ELECOM - Officer Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link rel="icon" href="img/icon.png">
  <link rel="stylesheet" href="css/dashboard.css"/>
  <link rel="stylesheet" href="css/body.css"/>
  <link rel="stylesheet" href="css/calendar.css">
</head>
<body>
<!-- Loading Overlay -->
<div id="loading-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(44,62,80,0.97);z-index:2000;display:flex;align-items:center;justify-content:center;animation:fadeIn 0.6s;">
  <div style="display:flex;flex-direction:column;align-items:center;">
    <img src="img/icon.png" alt="ELECOM Logo" style="width:70px;height:70px;margin-bottom:22px;animation:bounce 1.2s infinite alternate;filter:drop-shadow(0 2px 12px #2563eb55);">
    <div class="loader-enhanced"></div>
    <span style="color:#fff;margin-top:22px;font-size:1.25rem;letter-spacing:1px;font-weight:600;">Loading Dashboard...</span>
  </div>
</div>
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
@keyframes bounce {
  0% { transform: translateY(0); }
  100% { transform: translateY(-18px); }
}
.loader-enhanced {
  border: 10px solid #f3f3f3;
  border-top: 10px solid #2563eb;
  border-right: 10px solid #3498db;
  border-bottom: 10px solid #2980b9;
  border-left: 10px solid #f3f3f3;
  border-radius: 50%;
  width: 80px;
  height: 80px;
  animation: spin 1.1s linear infinite;
  box-shadow: 0 4px 24px 0 #2563eb22;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelector('.sticky-header').style.display = 'none';
  document.querySelector('.sidebar').style.display = 'none';
  document.querySelector('.main-content').style.display = 'none';
});
window.onload = function() {
  const overlay = document.getElementById('loading-overlay');
  overlay.style.transition = 'opacity 0.5s';
  overlay.style.opacity = 0;
  setTimeout(() => {
    overlay.style.display = 'none';
    document.querySelector('.sticky-header').style.display = '';
    document.querySelector('.sidebar').style.display = '';
    document.querySelector('.main-content').style.display = '';
  }, 500);
};
</script>
<!-- End Loading Overlay -->

  <!-- Sticky Header -->
  <div class="sticky-header">
    <button class="menu-icon" onclick="toggleMenu()">
      <img src="img/icon.png" alt="ELECOM Logo">
    </button>
    <p class="orgName">Electoral Commission</p>
    <div class="profile-section">
        <div class="profile-dropdown">
            <img class="profile" src="img/profile (1).png" alt="Profile Picture" />
            <p class="names" id="officerName"></p>
        </div>
        <div class="dropdown-menu">
            <a href="#"><i class="fas fa-user"></i> Profile</a>
            <a href="Elecom.html" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>
  </div>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <button class="toggle-icon" onclick="toggleSidebar()">
      <i class="fas fa-angle-left"></i>
    </button>
    <h2>Dashboard</h2>
    <ul>
        <li><i class="fas fa-house-user"></i> <span>Home</span></li>
        <li><i class="fas fa-users"></i> <span>Candidates</span></li>
        <li><i class="fas fa-plus-circle"></i> <span>Add Candidate</span></li>
        <li><i class="fas fa-trash"></i> <span>Remove Candidate</span></li>
        <li><i class="fas fa-chart-bar"></i> <span>All Results</span></li>
        <li><i class="fas fa-sign-out-alt"></i> <span onclick="logout()">Logout</span></li>
    </ul>
  </div>
  <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

  <!-- Main Content -->
  <div class="main-content">
    
    
  </div>

  <script>
    // Set officer info from localStorage
    const userId = localStorage.getItem('currentUser');
    document.getElementById('officerName').textContent = userId;

    // Load all candidates
    function loadAllCandidates() {
      fetch('get_candidates.php?all=1')
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById('allCandidates');
          list.innerHTML = '';
          data.forEach(c => {
            list.innerHTML += `
              <div class="border rounded p-2 mb-2 d-flex justify-content-between align-items-center">
                <span>${c.name} (${c.department}, ${c.position})</span>
                <button class="btn btn-danger btn-sm" onclick="removeCandidate(${c.candidate_id})">Remove</button>
              </div>`;
          });
        });
    }

    // Load all results
    function loadAllResults() {
      fetch('get_results.php?all=1')
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById('allResults');
          list.innerHTML = '';
          data.forEach(r => {
            list.innerHTML += `<div class="border rounded p-2 mb-2">${r.name} (${r.department}, ${r.position}): <b>${r.votes} votes</b></div>`;
          });
        });
    }

    // Add candidate
    document.getElementById('addCandidateForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('candidateName').value.trim();
      const department = document.getElementById('candidateDept').value;
      const position = document.getElementById('candidatePosition').value;
      const addSuccess = document.getElementById('addSuccess');
      const addError = document.getElementById('addError');
      addSuccess.classList.add('d-none');
      addError.classList.add('d-none');
      fetch('add_candidate.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, department, position })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          addSuccess.textContent = data.message;
          addSuccess.classList.remove('d-none');
          loadAllCandidates();
        } else {
          addError.textContent = data.message;
          addError.classList.remove('d-none');
        }
      });
    });

    // Remove candidate
    function removeCandidate(candidateId) {
      if (!confirm('Are you sure you want to remove this candidate?')) return;
      fetch('remove_candidate.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ candidate_id: candidateId })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          loadAllCandidates();
        } else {
          alert(data.message);
        }
      });
    }

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }

    // Initial load
    loadAllCandidates();
    loadAllResults();
    window.removeCandidate = removeCandidate; // Expose to global

    // Responsive sidebar toggle for mobile
    function toggleSidebar() {
      var sidebar = document.getElementById('sidebar');
      var backdrop = document.getElementById('sidebar-backdrop');
      sidebar.classList.toggle('show');
      if (sidebar.classList.contains('show')) {
        backdrop.classList.add('active');
        document.body.style.overflow = 'hidden';
      } else {
        backdrop.classList.remove('active');
        document.body.style.overflow = '';
      }
    }
    document.getElementById('sidebar-backdrop').onclick = function() {
      document.getElementById('sidebar').classList.remove('show');
      this.classList.remove('active');
      document.body.style.overflow = '';
    };
  </script>
  <script src="function/dashboard.js"></script>
  <script src="function/calendar.js"></script>
</body>
</html> 